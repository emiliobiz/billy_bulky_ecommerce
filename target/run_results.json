{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.1", "generated_at": "2023-11-21T12:23:58.944268Z", "invocation_id": "85957646-6f3f-4a66-aa83-8a9b45d5d2bd", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-21T12:23:52.591157Z", "completed_at": "2023-11-21T12:23:52.597105Z"}, {"name": "execute", "started_at": "2023-11-21T12:23:52.623693Z", "completed_at": "2023-11-21T12:23:53.937831Z"}], "thread_id": "Thread-4", "execution_time": 1.8864750862121582, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b07a27-0001-8184-0004-d8be000105da"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.billy_bulky.staging_shopify__products", "compiled": true, "compiled_code": "WITH products AS (\n    SELECT * FROM SHOPIFY.PUBLIC.products\n)\n\nSELECT\n    PRODUCT_ID\n    , NAME\n    , CATEGORY\n    , PRICE\n    , STOCK_LEVEL\nFROM products", "relation_name": "E_COMMERCE.staging.staging_shopify__products"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-21T12:23:52.584527Z", "completed_at": "2023-11-21T12:23:52.595750Z"}, {"name": "execute", "started_at": "2023-11-21T12:23:52.621182Z", "completed_at": "2023-11-21T12:23:53.935750Z"}], "thread_id": "Thread-2", "execution_time": 1.9009950160980225, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b07a27-0001-8184-0004-d8be000105d6"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.billy_bulky.staging_shopify__customers", "compiled": true, "compiled_code": "WITH customers AS (\n    SELECT * FROM SHOPIFY.PUBLIC.customers\n)\n\nSELECT\n    CUSTOMER_ID\n    , FIRST_NAME\n    , LAST_NAME\n    , EMAIL\n    , JOIN_DATE\n    , COUNTRY\nFROM customers", "relation_name": "E_COMMERCE.staging.staging_shopify__customers"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-21T12:23:52.572303Z", "completed_at": "2023-11-21T12:23:52.597912Z"}, {"name": "execute", "started_at": "2023-11-21T12:23:52.625931Z", "completed_at": "2023-11-21T12:23:54.628914Z"}], "thread_id": "Thread-1", "execution_time": 2.530827045440674, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b07a27-0001-831c-0004-d8be00013596"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.billy_bulky.staging__shopify__products_history", "compiled": true, "compiled_code": "WITH products AS (\n    SELECT * FROM E_COMMERCE.SNAPSHOTS.products_snapshot\n)\n\nSELECT\n    PRODUCT_ID\n    , NAME\n    , CATEGORY\n    , PRICE\n    , STOCK_LEVEL\n    , DBT_SCD_ID\n    , DBT_UPDATED_AT\n    , DBT_VALID_FROM\n    , DBT_VALID_TO\nFROM products", "relation_name": "E_COMMERCE.staging.staging__shopify__products_history"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-21T12:23:52.587949Z", "completed_at": "2023-11-21T12:23:52.594854Z"}, {"name": "execute", "started_at": "2023-11-21T12:23:52.596226Z", "completed_at": "2023-11-21T12:23:54.640636Z"}], "thread_id": "Thread-3", "execution_time": 2.5286641120910645, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b07a27-0001-8184-0004-d8be000105de"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.billy_bulky.staging_shopify__orders", "compiled": true, "compiled_code": "WITH orders AS (\n    SELECT * FROM SHOPIFY.PUBLIC.orders\n)\n\nSELECT\n    ORDER_ID\n    , CUSTOMER_ID\n    , PRODUCT_ID\n    , QUANTITY\n    , ORDER_DATE\n    , STATUS\nFROM orders", "relation_name": "E_COMMERCE.staging.staging_shopify__orders"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-21T12:23:55.135546Z", "completed_at": "2023-11-21T12:23:55.162221Z"}, {"name": "execute", "started_at": "2023-11-21T12:23:55.168714Z", "completed_at": "2023-11-21T12:23:58.339008Z"}], "thread_id": "Thread-5", "execution_time": 3.5818707942962646, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b07a27-0001-8184-0004-d8be000105e2"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.billy_bulky.products", "compiled": true, "compiled_code": "WITH  __dbt__cte__int_products_performance as (\nWITH orders AS (\n    SELECT * FROM E_COMMERCE.staging.staging_shopify__orders\n)\n\n, products AS (\n    SELECT * FROM E_COMMERCE.staging.staging_shopify__products\n)\n\n, product_sales AS (\n    SELECT\n        o.PRODUCT_ID\n        , COUNT(DISTINCT o.ORDER_ID) AS total_sales\n        , SUM(o.QUANTITY) AS total_units_sold\n        , SUM(o.QUANTITY * p.PRICE) AS total_sales_value\n    FROM orders o\n    INNER JOIN products p ON o.PRODUCT_ID = p.PRODUCT_ID\n    WHERE o.STATUS NOT IN ('cancelled') \n    GROUP BY o.PRODUCT_ID\n)\n\n, product_averages AS (\n    SELECT\n        PRODUCT_ID\n        , (total_sales_value / NULLIF(total_units_sold, 0)) AS average_sale_price\n    FROM product_sales\n)\n\n, product_stock_turnover AS (\n    SELECT\n        p.PRODUCT_ID\n        , p.STOCK_LEVEL\n        , (total_units_sold / NULLIF(p.STOCK_LEVEL, 0)) AS turnover_rate\n    FROM product_sales ps\n    INNER JOIN products p ON ps.PRODUCT_ID = p.PRODUCT_ID\n)\n\n, final AS (\n    SELECT\n    p.PRODUCT_ID\n    , p.NAME\n    , p.CATEGORY\n    , p.PRICE\n    , pa.average_sale_price\n    , ps.total_sales\n    , ps.total_units_sold\n    , ps.total_sales_value\n    , pst.turnover_rate\n    , p.STOCK_LEVEL\nFROM products p\nLEFT JOIN product_sales ps ON p.PRODUCT_ID = ps.PRODUCT_ID\nLEFT JOIN product_averages pa ON p.PRODUCT_ID = pa.PRODUCT_ID\nLEFT JOIN product_stock_turnover pst ON p.PRODUCT_ID = pst.PRODUCT_ID\n)\n\nSELECT * FROM final\n), final AS (\n    SELECT\n        pp.PRODUCT_ID\n        , pp.NAME\n        , pp.CATEGORY\n        , pp.PRICE\n        , pp.average_sale_price\n        , pp.total_sales\n        , pp.total_units_sold\n        , pp.total_sales_value\n        , pp.turnover_rate\n        , pp.STOCK_LEVEL\n    FROM __dbt__cte__int_products_performance pp\n)\n\nSELECT * FROM final", "relation_name": "E_COMMERCE.marts.products"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-21T12:23:55.140104Z", "completed_at": "2023-11-21T12:23:55.148654Z"}, {"name": "execute", "started_at": "2023-11-21T12:23:55.149688Z", "completed_at": "2023-11-21T12:23:58.532755Z"}], "thread_id": "Thread-2", "execution_time": 3.7717552185058594, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b07a27-0001-834e-0004-d8be00011456"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.billy_bulky.sales", "compiled": true, "compiled_code": "WITH  __dbt__cte__int_sales_trend as (\nWITH orders AS (\n    SELECT * FROM E_COMMERCE.staging.staging_shopify__orders\n)\n\n, products AS (\n    SELECT * FROM E_COMMERCE.staging.staging_shopify__products\n)\n\n, daily_sales AS (\n    SELECT\n        DATE(ORDER_DATE) AS sale_date\n        , COUNT(DISTINCT ORDER_ID) AS total_orders\n        , SUM(QUANTITY) AS total_units_sold\n        , SUM(QUANTITY * PRICE) AS total_sales_value\n    FROM orders AS o\n    JOIN products AS p ON o.PRODUCT_ID = p.PRODUCT_ID\n    WHERE o.STATUS NOT IN ('cancelled') \n    GROUP BY sale_date\n)\n\n, weekly_sales AS (\n    SELECT\n        DATE_TRUNC('week', sale_date) AS sale_week\n        , SUM(total_orders) AS weekly_orders\n        , SUM(total_units_sold) AS weekly_units_sold\n        , SUM(total_sales_value) AS weekly_sales_value\n    FROM daily_sales\n    GROUP BY sale_week\n)\n\n, monthly_sales AS (\n    SELECT\n        DATE_TRUNC('month', sale_date) AS sale_month\n        , SUM(total_orders) AS monthly_orders\n        , SUM(total_units_sold) AS monthly_units_sold\n        , SUM(total_sales_value) AS monthly_sales_value\n    FROM daily_sales\n    GROUP BY sale_month\n)\n\n, yearly_sales AS (\n    SELECT\n        DATE_TRUNC('year', sale_date) AS sale_year\n        , SUM(total_orders) AS yearly_orders\n        , SUM(total_units_sold) AS yearly_units_sold\n        , SUM(total_sales_value) AS yearly_sales_value\n    FROM daily_sales\n    GROUP BY sale_year\n)\n\nSELECT\n    d.sale_date\n    , d.total_orders AS daily_orders\n    , d.total_units_sold AS daily_units_sold\n    , d.total_sales_value AS daily_sales_value\n    , w.weekly_orders\n    , w.weekly_units_sold\n    , w.weekly_sales_value\n    , m.monthly_orders\n    , m.monthly_units_sold\n    , m.monthly_sales_value\n    , y.yearly_orders\n    , y.yearly_units_sold\n    , y.yearly_sales_value\nFROM daily_sales d\nLEFT JOIN weekly_sales w ON DATE_TRUNC('week', d.sale_date) = w.sale_week\nLEFT JOIN monthly_sales m ON DATE_TRUNC('month', d.sale_date) = m.sale_month\nLEFT JOIN yearly_sales y ON DATE_TRUNC('year', d.sale_date) = y.sale_year\n), enriched_orders AS (\n    SELECT\n        o.ORDER_ID\n        , o.CUSTOMER_ID\n        , o.PRODUCT_ID\n        , o.QUANTITY\n        , o.ORDER_DATE\n        , o.STATUS\n        , p.CATEGORY\n        , p.PRICE AS unit_price\n        , (o.QUANTITY * p.PRICE) AS total_price\n        , c.COUNTRY\n    FROM E_COMMERCE.staging.staging_shopify__orders o\n    JOIN E_COMMERCE.staging.staging_shopify__products p ON o.PRODUCT_ID = p.PRODUCT_ID\n    JOIN E_COMMERCE.staging.staging_shopify__customers c ON o.CUSTOMER_ID = c.CUSTOMER_ID\n    WHERE o.STATUS NOT IN ('cancelled') \n)\n\nSELECT\n    eo.ORDER_ID\n    , eo.CUSTOMER_ID\n    , eo.PRODUCT_ID\n    , eo.QUANTITY\n    , eo.ORDER_DATE\n    , eo.STATUS\n    , eo.CATEGORY\n    , eo.unit_price\n    , eo.total_price\n    , eo.COUNTRY\n    , sa.daily_orders\n    , sa.daily_units_sold\n    , sa.daily_sales_value\nFROM enriched_orders eo\nLEFT JOIN __dbt__cte__int_sales_trend sa ON DATE(eo.ORDER_DATE) = sa.sale_date", "relation_name": "E_COMMERCE.marts.sales"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-21T12:23:55.126336Z", "completed_at": "2023-11-21T12:23:55.148935Z"}, {"name": "execute", "started_at": "2023-11-21T12:23:55.162478Z", "completed_at": "2023-11-21T12:23:58.576933Z"}], "thread_id": "Thread-10", "execution_time": 3.80472993850708, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01b07a27-0001-815a-0004-d8be0001827e"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.billy_bulky.customers", "compiled": true, "compiled_code": "WITH  __dbt__cte__int_customers_segmentation as (\nWITH customers AS (\n    SELECT * FROM E_COMMERCE.staging.staging_shopify__customers\n)\n\n, orders AS (\n    SELECT * FROM E_COMMERCE.staging.staging_shopify__orders\n)\n\n, products AS (\n    SELECT * FROM E_COMMERCE.staging.staging_shopify__products\n)\n\n, order_aggregates AS (\n    SELECT\n        o.CUSTOMER_ID\n        , COUNT(DISTINCT o.ORDER_ID) AS frequency\n        , SUM(o.QUANTITY * p.PRICE) AS monetary\n        , AVG(o.QUANTITY * p.PRICE) AS average_order_value\n        , MAX(o.ORDER_DATE) AS last_purchase_date\n        , COUNT(CASE WHEN o.STATUS = 'cancelled' THEN 1 END) AS cancelled_orders\n        , COUNT(*) AS total_orders\n    FROM orders o\n    JOIN products p ON o.PRODUCT_ID = p.PRODUCT_ID\n    GROUP BY o.CUSTOMER_ID\n)\n\n, customer_tenure AS (\n    SELECT\n        CUSTOMER_ID\n        , JOIN_DATE\n        , CURRENT_DATE - JOIN_DATE AS tenure\n    FROM customers\n)\n\n, customer_recency AS (\n    SELECT\n        CUSTOMER_ID\n        , CURRENT_DATE - last_purchase_date AS recency\n    FROM order_aggregates\n)\n\n, final AS (\n    SELECT\n        c.CUSTOMER_ID\n        , c.FIRST_NAME\n        , c.LAST_NAME\n        , c.EMAIL\n        , c.JOIN_DATE\n        , c.COUNTRY\n        , o.frequency\n        , o.monetary\n        , o.average_order_value\n        , o.cancelled_orders\n        , o.total_orders\n        , CASE \n            WHEN o.total_orders > 0 THEN ROUND((o.cancelled_orders::FLOAT / o.total_orders) * 100, 2) \n            ELSE 0 \n          END AS cancellation_rate\n        , r.recency\n        , t.tenure\n    FROM customer_tenure t\n    JOIN customers c ON t.CUSTOMER_ID = c.CUSTOMER_ID\n    JOIN order_aggregates o ON c.CUSTOMER_ID = o.CUSTOMER_ID\n    JOIN customer_recency r ON c.CUSTOMER_ID = r.CUSTOMER_ID\n)\n\nSELECT * FROM final\n), source AS (\n    SELECT\n        icp.CUSTOMER_ID\n        , icp.FIRST_NAME\n        , icp.LAST_NAME\n        , icp.EMAIL\n        , icp.JOIN_DATE\n        , icp.COUNTRY\n        , icp.frequency AS total_orders\n        , icp.monetary AS total_spent\n        , icp.recency\n        , icp.tenure\n    FROM __dbt__cte__int_customers_segmentation icp\n)\n\n, final AS (\nSELECT\n    s.CUSTOMER_ID\n    , s.FIRST_NAME\n    , s.LAST_NAME\n    , s.EMAIL\n    , s.JOIN_DATE\n    , s.COUNTRY\n    , s.total_orders\n    , s.total_spent\n    , s.recency\n    , s.tenure\n    , CASE\n        WHEN total_spent > 1000 THEN 'VIP'\n        ELSE 'Regular'\n    END AS customer_segment\nFROM source s\n)\n\nSELECT * FROM final", "relation_name": "E_COMMERCE.marts.customers"}], "elapsed_time": 10.359324932098389, "args": {"enable_legacy_logger": false, "select": [], "log_level_file": "debug", "profiles_dir": "/Users/bitlevi/.dbt", "warn_error_options": {"include": [], "exclude": []}, "invocation_command": "dbt run", "partial_parse_file_diff": true, "log_format_file": "debug", "introspect": true, "exclude": [], "use_colors": true, "show_resource_report": false, "printer_width": 80, "log_path": "/Users/bitlevi/Documents/billy_bulky_ecommerce/billy_bulky_ecommerce/logs", "macro_debugging": false, "use_colors_file": true, "populate_cache": true, "favor_state": false, "indirect_selection": "eager", "partial_parse": true, "print": true, "vars": {}, "send_anonymous_usage_stats": true, "quiet": false, "static_parser": true, "strict_mode": false, "write_json": true, "defer": false, "log_level": "info", "version_check": true, "log_file_max_bytes": 10485760, "which": "run", "log_format": "default", "cache_selected_only": false, "project_dir": "/Users/bitlevi/Documents/billy_bulky_ecommerce/billy_bulky_ecommerce"}}